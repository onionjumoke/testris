<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<title>iOS 3 Tetris</title>
<style>
body{margin:0;padding:0;font-family:Helvetica,Arial,sans-serif;text-align:center;background:#d8d8d8;color:#000;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-user-select:none;-webkit-touch-callout:none}
.header-bar{background:-webkit-gradient(linear,left top,left bottom,from(#b0bccd),to(#889bb3));height:44px;width:100%;border-bottom:1px solid #2d3642;-webkit-box-shadow:0 1px 2px rgba(0,0,0,0.2);position:relative;display:-webkit-box;-webkit-box-pack:center;-webkit-box-align:center}
h1{margin:0;font-size:20px;font-weight:bold;text-shadow:0 1px 0 rgba(255,255,255,0.5);color:#4c566c}
.game-container{margin:10px auto;width:300px;position:relative;background:rgba(255,255,255,0.8);-webkit-border-radius:10px;border:1px solid #a9a9a9;-webkit-box-shadow:0 1px 4px rgba(0,0,0,0.3);padding:10px}
table{border-collapse:collapse;margin:0 auto;background:#000;-webkit-border-radius:6px;overflow:hidden;border:1px solid #666}
td{width:20px;height:20px;border:1px solid #222;background-color:#111}
.score-container{background:-webkit-gradient(linear,left top,left bottom,from(#dddee1),to(#babbbc));border:1px solid #999;-webkit-border-radius:8px;margin:10px auto;padding:5px 10px;width:80%;-webkit-box-shadow:inset 0 1px 0 #fff}
.score{margin:5px auto;font-size:18px;font-weight:bold;color:#444;text-shadow:0 1px 0 #fff}
.controls{margin-top:15px;display:-webkit-box;-webkit-box-pack:center;-webkit-box-orient:horizontal;-webkit-box-lines:multiple;padding:0 10px}
.btn{width:70px;height:45px;margin:5px;font-size:20px;-webkit-border-radius:8px;background:-webkit-gradient(linear,left top,left bottom,from(#f4f5f7),to(#c2c3c5));border:1px solid #9e9e9e;-webkit-box-shadow:0 1px 2px rgba(0,0,0,0.2);text-shadow:0 1px 0 rgba(255,255,255,0.7);font-weight:bold;color:#4c566c;-webkit-appearance:none;position:relative}
.btn:after{content:'';position:absolute;top:0;left:0;right:0;height:50%;background:rgba(255,255,255,0.2);-webkit-border-top-left-radius:8px;-webkit-border-top-right-radius:8px}
.btn:active{background:-webkit-gradient(linear,left top,left bottom,from(#c2c3c5),to(#f4f5f7))}
.notice{color:#666;font-size:14px;margin:10px;text-shadow:0 1px 0 white}
/* Skeuomorphic pieces */
.piece-I{background:-webkit-gradient(linear,left top,left bottom,from(#7ee0ff),to(#39ccff));border:1px solid #4aa7c5;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,0.6),0 1px 2px rgba(0,0,0,0.2)}
.piece-O{background:-webkit-gradient(linear,left top,left bottom,from(#fffd94),to(#fceb54));border:1px solid #c7bc5b;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,0.6),0 1px 2px rgba(0,0,0,0.2)}
.piece-T{background:-webkit-gradient(linear,left top,left bottom,from(#de8aff),to(#be46fc));border:1px solid #a453c9;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,0.6),0 1px 2px rgba(0,0,0,0.2)}
.piece-S{background:-webkit-gradient(linear,left top,left bottom,from(#98eb8a),to(#58d340));border:1px solid #60b251;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,0.6),0 1px 2px rgba(0,0,0,0.2)}
.piece-Z{background:-webkit-gradient(linear,left top,left bottom,from(#ff8080),to(#ff3c3c));border:1px solid #cc4b4b;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,0.6),0 1px 2px rgba(0,0,0,0.2)}
.piece-J{background:-webkit-gradient(linear,left top,left bottom,from(#80a9ff),to(#4078ff));border:1px solid #4d74cc;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,0.6),0 1px 2px rgba(0,0,0,0.2)}
.piece-L{background:-webkit-gradient(linear,left top,left bottom,from(#ffc073),to(#ff9a31));border:1px solid #cc8d42;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,0.6),0 1px 2px rgba(0,0,0,0.2)}
</style>
</head>
<body>

<!-- iOS 6 Header Bar -->
<div class="header-bar">
  <h1>Tetris</h1>
</div>

<div class="game-container">
  <div class="score-container">
    <div class="score">Score: <span id="score">0</span></div>
  </div>

  <table id="board">
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  </table>
</div>

<div class="controls">
  <button id="left" class="btn" onclick="moveLeft()">←</button>
  <button id="rotate" class="btn" onclick="rotate()">↻</button>
  <button id="right" class="btn" onclick="moveRight()">→</button>
  <button id="down" class="btn" onclick="moveDown()">↓</button>
  <button id="drop" class="btn" onclick="hardDrop()">Drop</button>
</div>

<p class="notice">Tap anywhere to start/restart</p>

<script>
// Initialize game variables
var board=Array(20).fill().map(function(){return Array(10).fill(0)});
var currentPiece=null;
var currentX=0;
var currentY=0;
var score=0;
var gameOver=false;
var gameInterval;

// Define the shapes
var SHAPES={
  'I':{blocks:[[0,0],[0,1],[0,2],[0,3]],color:'piece-I'},
  'O':{blocks:[[0,0],[0,1],[1,0],[1,1]],color:'piece-O'},
  'T':{blocks:[[0,1],[1,0],[1,1],[1,2]],color:'piece-T'},
  'S':{blocks:[[0,1],[0,2],[1,0],[1,1]],color:'piece-S'},
  'Z':{blocks:[[0,0],[0,1],[1,1],[1,2]],color:'piece-Z'},
  'J':{blocks:[[0,0],[1,0],[1,1],[1,2]],color:'piece-J'},
  'L':{blocks:[[0,2],[1,0],[1,1],[1,2]],color:'piece-L'}
};

// Game initialization
function init(){
  document.getElementById('score').textContent='0';
  // Reset game state
  board=Array(20).fill().map(function(){return Array(10).fill(0)});
  currentPiece=null;
  currentX=0;
  currentY=0;
  score=0;
  gameOver=false;
  
  // Create the first piece
  newPiece();
  
  // Clear any existing interval and start a new one
  if(gameInterval)clearInterval(gameInterval);
  gameInterval=setInterval(tick,500);
}

function newPiece(){
  var pieces=Object.keys(SHAPES);
  var randomType=pieces[Math.floor(Math.random()*pieces.length)];
  currentPiece={
    type:randomType,
    blocks:SHAPES[randomType].blocks.map(function(block){return[block[0],block[1]]}),
    color:SHAPES[randomType].color
  };
  
  currentX=Math.floor(5-currentPiece.blocks[0].length/2);
  currentY=0;
  
  if(!isValidMove(0,0)){
    gameOver=true;
    setTimeout(function(){
      if(confirm('Game Over! Score: '+score+'\nPlay again?')){
        init();
      }
    },100);
    clearInterval(gameInterval);
  }
  
  draw();
}

function isValidMove(offsetX,offsetY,newBlocks){
  var blocks=newBlocks||currentPiece.blocks;
  return blocks.every(function(block){
    var x=currentX+block[1]+offsetX;
    var y=currentY+block[0]+offsetY;
    return(
      x>=0&&x<10&&y>=0&&y<20&&
      (y<0||board[y][x]===0)
    );
  });
}

function rotate(){
  if(gameOver)return;
  
  var newBlocks=currentPiece.blocks.map(function(block){
    return[block[1],-block[0]];
  });
  
  if(isValidMove(0,0,newBlocks)){
    currentPiece.blocks=newBlocks;
    draw();
  }
}

function moveLeft(){
  if(gameOver)return;
  if(isValidMove(-1,0)){
    currentX--;
    draw();
  }
}

function moveRight(){
  if(gameOver)return;
  if(isValidMove(1,0)){
    currentX++;
    draw();
  }
}

function moveDown(){
  if(gameOver)return;
  if(isValidMove(0,1)){
    currentY++;
    draw();
    return true;
  }
  
  // The piece has landed
  placePiece();
  return false;
}

function hardDrop(){
  if(gameOver)return;
  while(moveDown()){}
}

function placePiece(){
  currentPiece.blocks.forEach(function(block){
    var x=currentX+block[1];
    var y=currentY+block[0];
    if(y>=0&&y<20){
      board[y][x]=currentPiece.color;
    }
  });
  
  // Check for completed lines
  clearLines();
  newPiece();
}

function clearLines(){
  var linesCleared=0;
  
  for(var y=0;y<20;y++){
    if(board[y].every(function(cell){return cell!==0})){
      board.splice(y,1);
      board.unshift(Array(10).fill(0));
      linesCleared++;
    }
  }
  
  if(linesCleared>0){
    score+=[40,100,300,1200][linesCleared-1];
    document.getElementById('score').textContent=score;
  }
}

function tick(){
  if(gameOver)return;
  moveDown();
}

function draw(){
  // Clear the visual board
  var cells=document.querySelectorAll('#board td');
  for(var i=0;i<cells.length;i++){
    cells[i].className='';
  }
  
  // Draw the static blocks
  for(var y=0;y<20;y++){
    for(var x=0;x<10;x++){
      if(board[y][x]!==0){
        var cell=document.querySelector('#board tr:nth-child('+(y+1)+') td:nth-child('+(x+1)+')');
        cell.className=board[y][x];
      }
    }
  }
  
  // Draw the current piece
  currentPiece.blocks.forEach(function(block){
    var x=currentX+block[1];
    var y=currentY+block[0];
    if(y>=0&&y<20){
      var cell=document.querySelector('#board tr:nth-child('+(y+1)+') td:nth-child('+(x+1)+')');
      cell.className=currentPiece.color;
    }
  });
}

// Handle touch events for iOS 3
document.addEventListener('touchstart',function(e){
  // Start/restart game on tap anywhere
  if(gameOver){
    init();
    e.preventDefault();
  }
},false);

// Keyboard controls (for testing)
document.addEventListener('keydown',function(e){
  var key=e.keyCode;
  if(key===37)moveLeft();
  else if(key===39)moveRight();
  else if(key===40)moveDown();
  else if(key===38)rotate();
  else if(key===32)hardDrop();
},false);

// Initialize on page load
if(document.readyState==='complete'||document.readyState==='interactive'){
  setTimeout(init,1);
}else{
  document.addEventListener('DOMContentLoaded',init,false);
}
